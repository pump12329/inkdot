#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# 根据项目rules的提交前检查要求
echo "🔍 Running pre-commit checks as per project rules..."

# 1. 代码格式化和基本检查 (lint-staged)
echo "📝 Step 1: Running lint-staged (format, lint & timestamp check)..."
npx lint-staged || exit 1

# 2. TypeScript类型检查
echo "🔧 Step 2: TypeScript type checking..."
npm run type-check || exit 1

# 3. 单元测试 (快速验证核心功能)
echo "🧪 Step 3: Running unit tests..."
npm run test:unit || exit 1

# 4. 构建检查 (确保代码可以正常构建)
echo "🏗️  Step 4: Build verification..."
npm run build || exit 1

echo "✅ All pre-commit checks passed! Ready to commit."
echo ""
echo "📋 Note: Full test suite and E2E tests will run in CI/CD pipeline."
echo "💡 To run full tests locally: npm run test:run"
