# Git Hooks é…ç½®æŒ‡å—

## ğŸ¯ æ¦‚è¿°

æœ¬é¡¹ç›®ä½¿ç”¨ Husky é…ç½®äº†å®Œæ•´çš„ Git hooks å·¥ä½œæµï¼Œç¡®ä¿ä»£ç è´¨é‡å’Œæäº¤è§„èŒƒã€‚

## ğŸ“‹ Hooks åˆ—è¡¨

### 1. pre-commit

**æ‰§è¡Œæ—¶æœº**: æ‰§è¡Œ `git commit` å‘½ä»¤åï¼Œåœ¨ç¼–è¾‘å™¨æ‰“å¼€æäº¤ä¿¡æ¯ä¹‹å‰

**æ£€æŸ¥å†…å®¹**:

- âœ… ä»£ç æ ¼å¼åŒ– (lint-staged)
- âœ… TypeScript ç±»å‹æ£€æŸ¥
- âœ… æ„å»ºéªŒè¯
- âœ… å•å…ƒæµ‹è¯•

**ä¼˜åŒ–ç‰¹æ€§**:

- ğŸš€ æ™ºèƒ½è·³è¿‡ï¼šåªæ£€æŸ¥å˜æ›´çš„æ–‡ä»¶ç±»å‹
- â±ï¸ æ€§èƒ½ç›‘æ§ï¼šæ˜¾ç¤ºæ¯é¡¹æ£€æŸ¥çš„è€—æ—¶
- ğŸ“¦ å¢é‡æ„å»ºï¼šå°æ–‡ä»¶å˜æ›´æ—¶ä½¿ç”¨ç¼“å­˜

### 2. commit-msg

**æ‰§è¡Œæ—¶æœº**: æäº¤ä¿¡æ¯ç¼–è¾‘å®Œæˆåï¼Œå®é™…æäº¤ä¹‹å‰

**æ£€æŸ¥å†…å®¹**:

- âœ… æäº¤ä¿¡æ¯æ ¼å¼è§„èŒƒ
- âœ… é•¿åº¦é™åˆ¶ (72å­—ç¬¦)
- âœ… ç±»å‹éªŒè¯ (feat, fix, docs ç­‰)
- âœ… æè¿°å®Œæ•´æ€§

**æ”¯æŒçš„ç±»å‹**:

- `feat`: æ–°åŠŸèƒ½
- `fix`: ä¿®å¤bug
- `docs`: æ–‡æ¡£æ›´æ–°
- `style`: ä»£ç æ ¼å¼ (ä¸å½±å“åŠŸèƒ½)
- `refactor`: é‡æ„
- `test`: æµ‹è¯•ç›¸å…³
- `chore`: æ„å»ºå·¥å…·ã€ä¾èµ–æ›´æ–°
- `perf`: æ€§èƒ½ä¼˜åŒ–
- `ci`: CI/CD ç›¸å…³
- `build`: æ„å»ºç³»ç»Ÿ
- `revert`: å›æ»šæäº¤
- `WIP`: å·¥ä½œè¿›è¡Œä¸­

### 3. prepare-commit-msg

**æ‰§è¡Œæ—¶æœº**: æäº¤ä¿¡æ¯ç¼–è¾‘å™¨æ‰“å¼€ä¹‹åï¼Œè¾“å…¥ä¿¡æ¯ä¹‹å‰

**åŠŸèƒ½**:

- ğŸ’¡ æ™ºèƒ½å»ºè®®ï¼šæ ¹æ®æ–‡ä»¶å˜æ›´å»ºè®®æäº¤ç±»å‹
- ğŸ“ æ¨¡æ¿ç”Ÿæˆï¼šä¸ºç‰¹å®šç±»å‹æä¾›æäº¤ä¿¡æ¯æ¨¡æ¿

### 4. pre-push

**æ‰§è¡Œæ—¶æœº**: æ‰§è¡Œ `git push` å‘½ä»¤åï¼Œå®é™…æ¨é€ä¹‹å‰

**æ£€æŸ¥å†…å®¹**:

- âœ… å®Œæ•´æµ‹è¯•å¥—ä»¶ (ä¸»åˆ†æ”¯æ¨é€)
- âœ… æµ‹è¯•è¦†ç›–ç‡æ£€æŸ¥
- âœ… åˆ†æ”¯åç§°è§„èŒƒå»ºè®®
- âœ… æ¨é€ç»Ÿè®¡ä¿¡æ¯

**åˆ†æ”¯å·®å¼‚åŒ–å¤„ç†**:

- **ä¸»åˆ†æ”¯ (main/master)**: è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶å’Œè¦†ç›–ç‡æ£€æŸ¥
- **å…¶ä»–åˆ†æ”¯**: åªè¿è¡Œå¿«é€Ÿæµ‹è¯•ï¼Œå®Œæ•´æµ‹è¯•åœ¨CIä¸­æ‰§è¡Œ

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### 1. æ™ºèƒ½è·³è¿‡æœºåˆ¶

```bash
# åªæœ‰ä»£ç æ–‡ä»¶å˜æ›´æ—¶æ‰è¿è¡Œç±»å‹æ£€æŸ¥å’Œæ„å»º
if [ $STAGED_CODE_FILES -gt 0 ]; then
  # è¿è¡Œç›¸å…³æ£€æŸ¥
else
  echo "â­ï¸ Skipping checks (no code files changed)"
fi
```

### 2. å¹¶è¡Œæ‰§è¡Œ

- lint-staged æ”¯æŒå¹¶è¡Œå¤„ç†å¤šä¸ªæ–‡ä»¶
- TypeScript æ£€æŸ¥ä½¿ç”¨å¢é‡ç¼–è¯‘

### 3. ç¼“å­˜ç­–ç•¥

- å°æ–‡ä»¶å˜æ›´æ—¶ä½¿ç”¨å¢é‡æ„å»º
- ä¿ç•™æ„å»ºç¼“å­˜å‡å°‘é‡å¤å·¥ä½œ

### 4. æ€§èƒ½ç›‘æ§

æ¯ä¸ªæ­¥éª¤éƒ½æ˜¾ç¤ºæ‰§è¡Œæ—¶é—´ï¼Œå¸®åŠ©è¯†åˆ«æ€§èƒ½ç“¶é¢ˆï¼š

```
âœ… Lint-staged passed (234ms)
âœ… TypeScript check passed (567ms)
âœ… Build check passed (1234ms)
âœ… Unit tests passed (89ms)
ğŸ‰ All checks passed! Total time: 2124ms
```

## ğŸ› ï¸ é…ç½®æ–‡ä»¶è¯´æ˜

### package.json - lint-staged é…ç½®

```json
{
  "lint-staged": {
    "*.{js,ts,vue}": ["eslint --fix --quiet", "prettier --write --log-level warn"],
    "*.md": [
      "node docs/tools/timestamp-helper.js check-timestamp",
      "prettier --write --log-level warn"
    ]
  }
}
```

### .husky/ ç›®å½•ç»“æ„

```
.husky/
â”œâ”€â”€ _/              # Husky å†…éƒ¨æ–‡ä»¶
â”œâ”€â”€ pre-commit      # æäº¤å‰æ£€æŸ¥
â”œâ”€â”€ commit-msg      # æäº¤ä¿¡æ¯éªŒè¯
â”œâ”€â”€ prepare-commit-msg  # æäº¤ä¿¡æ¯å‡†å¤‡
â”œâ”€â”€ pre-push        # æ¨é€å‰æ£€æŸ¥
â”œâ”€â”€ README.md       # Hooks è¯´æ˜æ–‡æ¡£
â””â”€â”€ HOOKS_GUIDE.md  # è¯¦ç»†é…ç½®æŒ‡å—
```

## ğŸ“ æœ€ä½³å®è·µ

### 1. æäº¤ä¿¡æ¯è§„èŒƒ

```bash
# å¥½çš„ä¾‹å­
feat(mindmap): add node drag and drop functionality
fix(canvas): resolve zoom issue on mobile devices
docs(api): update authentication endpoint documentation
test(components): add unit tests for MindMapNode component

# ä¸å¥½çš„ä¾‹å­
fixed bug
update files
wip
```

### 2. åˆ†æ”¯å‘½åè§„èŒƒ

```bash
# æ¨èæ ¼å¼
feat/add-node-dragging
fix/mobile-zoom-issue
docs/update-api-docs
test/improve-coverage
```

### 3. å¸¸ç”¨å‘½ä»¤

```bash
# ç»•è¿‡ hooks (ä¸æ¨è)
git commit --no-verify -m "message"
git push --no-verify

# æ‰‹åŠ¨è¿è¡Œæ£€æŸ¥
npm run lint:fix
npm run type-check
npm run test:unit
npm run build

# è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
npm run test:run
npm run test:coverage
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **Pre-commit hook æ‰§è¡Œå¤±è´¥**

   ```bash
   # æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯
   git commit -v

   # æ‰‹åŠ¨è¿è¡Œæ£€æŸ¥
   npm run lint:fix
   npm run type-check
   ```

2. **Commit message æ ¼å¼é”™è¯¯**

   ```bash
   # ä¿®æ”¹æœ€åä¸€æ¬¡æäº¤ä¿¡æ¯
   git commit --amend

   # ä½¿ç”¨æ­£ç¡®æ ¼å¼
   git commit -m "feat(scope): description"
   ```

3. **Push hook æ‰§è¡Œæ—¶é—´è¿‡é•¿**
   - æ£€æŸ¥æ˜¯å¦æ¨é€äº†å¤§é‡æäº¤
   - è€ƒè™‘åˆå¹¶ç›¸å…³æäº¤
   - å¯¹äºéä¸»åˆ†æ”¯ï¼Œåªè¿è¡Œå¿«é€Ÿæ£€æŸ¥

### è°ƒè¯•æ¨¡å¼

ä¸º hooks æ·»åŠ è°ƒè¯•è¾“å‡ºï¼š

```bash
# åœ¨ hook æ–‡ä»¶ä¸­æ·»åŠ 
set -x  # å¼€å¯è°ƒè¯•æ¨¡å¼
echo "DEBUG: Running hook..."
```

## ğŸ“ˆ æ€§èƒ½ç»Ÿè®¡

### å…¸å‹æ‰§è¡Œæ—¶é—´ (åŸºäºé¡¹ç›®å½“å‰çŠ¶æ€)

- **lint-staged**: 200-500ms
- **TypeScript æ£€æŸ¥**: 500-1000ms
- **æ„å»ºéªŒè¯**: 1000-2000ms
- **å•å…ƒæµ‹è¯•**: 100-300ms

**æ€»è®¡**: 2-4ç§’ (å–å†³äºå˜æ›´èŒƒå›´)

### ä¼˜åŒ–å»ºè®®

1. ä¿æŒé¡¹ç›®è§„æ¨¡é€‚ä¸­
2. åˆç†ä½¿ç”¨ git ignore
3. å®šæœŸæ¸…ç†ä¸å¿…è¦çš„æ–‡ä»¶
4. ä¼˜åŒ– TypeScript é…ç½®

## ğŸ”„ ç‰ˆæœ¬å†å²

- **v2.1.0**: æ·»åŠ æ€§èƒ½ç›‘æ§å’Œæ™ºèƒ½è·³è¿‡
- **v2.0.0**: å®Œæ•´ hooks å·¥ä½œæµ
- **v1.0.0**: åŸºç¡€ pre-commit hook

---

**é…ç½®ç‰ˆæœ¬**: v2.1.0
**æœ€åæ›´æ–°**: $(date +"T%Y.%m.%d")
**ç»´æŠ¤è€…**: é¡¹ç›®å›¢é˜Ÿ
